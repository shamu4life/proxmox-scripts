#!/usr/bin/env bash

# Copyright (c) 2021-2025 tteck
# Author: tteck (tteckster)
# License: MIT | https://github.com/community-scripts/ProxmoxVE/raw/main/LICENSE
# Source: https://github.com/yt-dlp/yt-dlp
#
# DO NOT EDIT THIS SCRIPT
# This script is maintained by community-scripts
# https://github.com/community-scripts/ProxmoxVE/

source <(curl -sSL https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/misc/build.func)

# Set container variables
APP="yt-dlp"
var_tags="${var_tags:-media}"
var_cpu="${var_cpu:-2}"
var_ram="${var_ram:-2048}"
var_disk="${var_disk:-10}"
var_os="${var_os:-debian}"
var_version="${var_version:-12}"
var_unprivileged="${var_unprivileged:-1}"
var_install="false" # Prevent the helper script from trying to run a remote installer

# Run setup
header_info
variables
color
catch_errors

start
build_container

# Get the container ID
CTID=$(pvesh get /cluster/resources --type vm --output-format json | \
  jq -r --arg NAME "$var_hostname" '.[] | select(.name==$NAME) | .vmid')

# --- Direct Installation Steps ---
msg_info "Starting yt-dlp installation..."

# Run all installation commands inside the container
pct exec $CTID -- bash -c ' \
  export DEBIAN_FRONTEND=noninteractive; \
  apt-get update && \
  apt-get install -y ffmpeg python3-pip aria2 ca-certificates git && \
  pip3 install --upgrade yt-dlp && \
  apt-get autoremove -y && \
  apt-get clean -y'

# --- End Direct Installation Steps ---

description

msg_ok "Completed Successfully!\n"
echo -e "${CREATING}${GN}${APP} has been successfully installed in LXC ${CTID}.${CL}"
echo -e "${INFO}${YW} You can access the container via the Proxmox console or SSH (if configured).${CL}"
